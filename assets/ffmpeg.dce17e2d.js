var we=Object.defineProperty;var D=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var oe=(r,i,n)=>i in r?we(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,Y=(r,i)=>{for(var n in i||(i={}))ne.call(i,n)&&oe(r,n,i[n]);if(D)for(var n of D(i))ie.call(i,n)&&oe(r,n,i[n]);return r};var ae=(r,i)=>{var n={};for(var s in r)ne.call(r,s)&&i.indexOf(s)<0&&(n[s]=r[s]);if(r!=null&&D)for(var s of D(r))i.indexOf(s)<0&&ie.call(r,s)&&(n[s]=r[s]);return n};import{c as ye,r as T,R as L}from"./vendor.5d2cbba9.js";var be={exports:{}};(function(r){var i=function(n){var s=Object.prototype,l=s.hasOwnProperty,f,m=typeof Symbol=="function"?Symbol:{},d=m.iterator||"@@iterator",E=m.asyncIterator||"@@asyncIterator",O=m.toStringTag||"@@toStringTag";function g(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{g({},"")}catch{g=function(e,o,c){return e[o]=c}}function S(t,e,o,c){var a=e&&e.prototype instanceof _?e:_,h=Object.create(a.prototype),w=new H(c||[]);return h._invoke=ge(t,o,w),h}n.wrap=S;function k(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(c){return{type:"throw",arg:c}}}var A="suspendedStart",z="suspendedYield",W="executing",U="completed",F={};function _(){}function u(){}function p(){}var v={};g(v,d,function(){return this});var P=Object.getPrototypeOf,$=P&&P(P(J([])));$&&$!==s&&l.call($,d)&&(v=$);var C=p.prototype=_.prototype=Object.create(v);u.prototype=p,g(C,"constructor",p),g(p,"constructor",u),u.displayName=g(p,O,"GeneratorFunction");function ee(t){["next","throw","return"].forEach(function(e){g(t,e,function(o){return this._invoke(e,o)})})}n.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===u||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,g(t,O,"GeneratorFunction")),t.prototype=Object.create(C),t},n.awrap=function(t){return{__await:t}};function I(t,e){function o(h,w,y,j){var b=k(t[h],t,w);if(b.type==="throw")j(b.arg);else{var Z=b.arg,N=Z.value;return N&&typeof N=="object"&&l.call(N,"__await")?e.resolve(N.__await).then(function(R){o("next",R,y,j)},function(R){o("throw",R,y,j)}):e.resolve(N).then(function(R){Z.value=R,y(Z)},function(R){return o("throw",R,y,j)})}}var c;function a(h,w){function y(){return new e(function(j,b){o(h,w,j,b)})}return c=c?c.then(y,y):y()}this._invoke=a}ee(I.prototype),g(I.prototype,E,function(){return this}),n.AsyncIterator=I,n.async=function(t,e,o,c,a){a===void 0&&(a=Promise);var h=new I(S(t,e,o,c),a);return n.isGeneratorFunction(e)?h:h.next().then(function(w){return w.done?w.value:h.next()})};function ge(t,e,o){var c=A;return function(h,w){if(c===W)throw new Error("Generator is already running");if(c===U){if(h==="throw")throw w;return re()}for(o.method=h,o.arg=w;;){var y=o.delegate;if(y){var j=te(y,o);if(j){if(j===F)continue;return j}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(c===A)throw c=U,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);c=W;var b=k(t,e,o);if(b.type==="normal"){if(c=o.done?U:z,b.arg===F)continue;return{value:b.arg,done:o.done}}else b.type==="throw"&&(c=U,o.method="throw",o.arg=b.arg)}}}function te(t,e){var o=t.iterator[e.method];if(o===f){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=f,te(t,e),e.method==="throw"))return F;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return F}var c=k(o,t.iterator,e.arg);if(c.type==="throw")return e.method="throw",e.arg=c.arg,e.delegate=null,F;var a=c.arg;if(!a)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,F;if(a.done)e[t.resultName]=a.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=f);else return a;return e.delegate=null,F}ee(C),g(C,O,"Generator"),g(C,d,function(){return this}),g(C,"toString",function(){return"[object Generator]"});function ve(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function H(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(ve,this),this.reset(!0)}n.keys=function(t){var e=[];for(var o in t)e.push(o);return e.reverse(),function c(){for(;e.length;){var a=e.pop();if(a in t)return c.value=a,c.done=!1,c}return c.done=!0,c}};function J(t){if(t){var e=t[d];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var o=-1,c=function a(){for(;++o<t.length;)if(l.call(t,o))return a.value=t[o],a.done=!1,a;return a.value=f,a.done=!0,a};return c.next=c}}return{next:re}}n.values=J;function re(){return{value:f,done:!0}}return H.prototype={constructor:H,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(V),!t)for(var e in this)e.charAt(0)==="t"&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=f)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(j,b){return h.type="throw",h.arg=t,e.next=j,b&&(e.method="next",e.arg=f),!!b}for(var c=this.tryEntries.length-1;c>=0;--c){var a=this.tryEntries[c],h=a.completion;if(a.tryLoc==="root")return o("end");if(a.tryLoc<=this.prev){var w=l.call(a,"catchLoc"),y=l.call(a,"finallyLoc");if(w&&y){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(w){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else if(y){if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o];if(c.tryLoc<=this.prev&&l.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var a=c;break}}a&&(t==="break"||t==="continue")&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var h=a?a.completion:{};return h.type=t,h.arg=e,a?(this.method="next",this.next=a.finallyLoc,F):this.complete(h)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),F},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),V(o),F}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var c=o.completion;if(c.type==="throw"){var a=c.arg;V(o)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:J(t),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=f),F}},n}(r.exports);try{regeneratorRuntime=i}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}})(be);var Ee={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let X=!1,ue=()=>{};const Fe=r=>{X=r},Le=r=>{ue=r},Se=(r,i)=>{ue({type:r,message:i}),X&&console.log(`[${r}] ${i}`)};var pe={logging:X,setLogging:Fe,setCustomLogger:Le,log:Se};let B=0,K=0;const se=r=>{const[i,n,s]=r.split(":");return parseFloat(i)*60*60+parseFloat(n)*60+parseFloat(s)};var $e=(r,i)=>{if(typeof r=="string")if(r.startsWith("  Duration")){const n=r.split(", ")[0].split(": ")[1],s=se(n);i({duration:s,ratio:K}),(B===0||B>s)&&(B=s)}else if(r.startsWith("frame")||r.startsWith("size")){const n=r.split("time=")[1].split(" ")[0],s=se(n);K=s/B,i({ratio:K,time:s})}else r.startsWith("video:")&&(i({ratio:1}),B=0)},je=(r,i)=>{const n=r._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((s,l)=>{const f=r._malloc(s.length+1);r.writeAsciiToMemory(s,f),r.setValue(n+Uint32Array.BYTES_PER_ELEMENT*l,f,"i32")}),[i.length,n]},q={exports:{}};(function(r,i){(function(n,s){r.exports=s()})(ye,function(){function n(){var s=arguments.length;if(s===0)throw new Error("resolveUrl requires at least one argument; got none.");var l=document.createElement("base");if(l.href=arguments[0],s===1)return l.href;var f=document.getElementsByTagName("head")[0];f.insertBefore(l,f.firstChild);for(var m=document.createElement("a"),d,E=1;E<s;E++)m.href=arguments[E],d=m.href,l.href=d;return f.removeChild(l),d}return n})})(q);const ke="@ffmpeg/ffmpeg",Pe="0.9.8",Oe="FFmpeg WebAssembly version",Ce="src/index.js",Re="src/index.d.ts",Ge={example:"examples"},Ae={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Ue={"./src/node/index.js":"./src/browser/index.js"},_e={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Te=["ffmpeg","WebAssembly","video"],Ne="Jerome Wu <jeromewus@gmail.com>",Be="MIT",xe={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Me={node:">=12.16.1"},We="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Ie={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},De={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.9.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var he={name:ke,version:Pe,description:Oe,main:Ce,types:Re,directories:Ge,scripts:Ae,browser:Ue,repository:_e,keywords:Te,author:Ne,license:Be,bugs:xe,engines:Me,homepage:We,dependencies:Ie,devDependencies:De};const Ye=q.exports,{devDependencies:qe}=he;var ze={corePath:typeof process!="undefined"&&{}.FFMPEG_ENV==="development"?Ye("/node_modules/@ffmpeg/core/dist/ffmpeg-core.js"):`https://unpkg.com/@ffmpeg/core@${qe["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Ve=q.exports,{log:M}=pe,Q=async(r,i)=>{M("info",`fetch ${r}`);const n=await(await fetch(r)).arrayBuffer();M("info",`${r} file size = ${n.byteLength} bytes`);const s=new Blob([n],{type:i}),l=URL.createObjectURL(s);return M("info",`${r} blob URL = ${l}`),l};var He=async({corePath:r})=>{if(typeof r!="string")throw Error("corePath should be a string!");const i=Ve(r),n=await Q(i,"application/javascript"),s=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),l=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(f=>{const m=document.createElement("script"),d=()=>{m.removeEventListener("load",d),M("info","ffmpeg-core.js script loaded"),f({createFFmpegCore,corePath:n,wasmPath:s,workerPath:l})};m.src=n,m.type="text/javascript",m.addEventListener("load",d),document.getElementsByTagName("head")[0].appendChild(m)}):(M("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:n,wasmPath:s,workerPath:l}))};const Je=q.exports,Ze=r=>new Promise((i,n)=>{const s=new FileReader;s.onload=()=>{i(s.result)},s.onerror=({target:{error:{code:l}}})=>{n(Error(`File could not be read! Code=${l}`))},s.readAsArrayBuffer(r)});var Ke=async r=>{let i=r;return typeof r=="undefined"?new Uint8Array:(typeof r=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?i=atob(r.split(",")[1]).split("").map(n=>n.charCodeAt(0)):i=await(await fetch(Je(r))).arrayBuffer():(r instanceof File||r instanceof Blob)&&(i=await Ze(r)),new Uint8Array(i))};const Qe=ze,Xe=He,et=Ke;var me={defaultOptions:Qe,getCreateFFmpegCore:Xe,fetchFile:et};const{defaultArgs:tt,baseOptions:rt}=Ee,{setLogging:ce,setCustomLogger:le,log:G}=pe,ot=$e,nt=je,{defaultOptions:it,getCreateFFmpegCore:at}=me,{version:st}=he,fe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var ct=(r={})=>{const _=Y(Y(Y({},rt),it),r),{log:i,logger:n,progress:s}=_,l=ae(_,["log","logger","progress"]);let f=null,m=null,d=null,E=!1,O=s;const g=u=>{u==="FFMPEG_END"&&d!==null&&(d(),d=null,E=!1)},S=({type:u,message:p})=>{G(u,p),ot(p,O),g(p)},k=async()=>{if(G("info","load ffmpeg-core"),f===null){G("info","loading ffmpeg-core");const{createFFmpegCore:u,corePath:p,workerPath:v,wasmPath:P}=await at(l);f=await u({mainScriptUrlOrBlob:p,printErr:$=>S({type:"fferr",message:$}),print:$=>S({type:"ffout",message:$}),locateFile:($,C)=>{if(typeof window!="undefined"){if(typeof P!="undefined"&&$.endsWith("ffmpeg-core.wasm"))return P;if(typeof v!="undefined"&&$.endsWith("ffmpeg-core.worker.js"))return v}return C+$}}),m=f.cwrap("proxy_main","number",["number","number"]),G("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},A=()=>f!==null,z=(...u)=>{if(G("info",`run ffmpeg command: ${u.join(" ")}`),f===null)throw fe;if(E)throw Error("ffmpeg.wasm can only run one command at a time");return E=!0,new Promise(p=>{const v=[...tt,...u].filter(P=>P.length!==0);d=p,m(...nt(f,v))})},W=(u,...p)=>{if(G("info",`run FS.${u} ${p.map(v=>typeof v=="string"?v:`<${v.length} bytes binary file>`).join(" ")}`),f===null)throw fe;{let v=null;try{v=f.FS[u](...p)}catch{throw Error(u==="readdir"?`ffmpeg.FS('readdir', '${p[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:u==="readFile"?`ffmpeg.FS('readFile', '${p[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return v}},U=u=>{O=u},F=u=>{le(u)};return ce(i),le(n),G("info",`use ffmpeg.wasm v${st}`),{setProgress:U,setLogger:F,setLogging:ce,load:k,isLoaded:A,run:z,FS:W}};const lt=ct,{fetchFile:ft}=me;var de={createFFmpeg:lt,fetchFile:ft};const x=de.createFFmpeg({log:!0});function mt(){const[r,i]=T.exports.useState(!1),[n,s]=T.exports.useState("Click Start to transcode"),[l,f]=T.exports.useState(null),[m,d]=T.exports.useState(null),[E,O]=T.exports.useState(0);T.exports.useEffect(()=>{(async()=>(await x.load(),i(!0),x.setProgress(S=>{O(+(S.ratio*100).toFixed(2))})))()},[]);const g=async()=>{if(!l)return;const S=l==null?void 0:l.name;s("Start transcoding"),x.FS("writeFile",S,await de.fetchFile(l)),await x.run("-i",S,"test.gif"),s("End transcoding");const k=x.FS("readFile","test.gif"),A=URL.createObjectURL(new Blob([k.buffer],{type:"image/gif"}));d(A)};return r?L.createElement("div",null,L.createElement(ut,{file:l}),L.createElement("br",null),L.createElement("input",{type:"file",onChange:S=>{var k;return f((k=S.target.files)==null?void 0:k[0])}}),L.createElement("br",null),l&&L.createElement("button",{onClick:g},"convert to gif"),L.createElement("br",null),n,E!==0&&E!==100&&L.createElement("div",null,E,"%"),L.createElement("br",null),m&&L.createElement("img",{width:500,src:m})):L.createElement("div",null,"loading...")}const ut=L.memo(({file:r})=>r&&L.createElement("video",{controls:!0,width:400,src:URL.createObjectURL(r)}));export{mt as default};
