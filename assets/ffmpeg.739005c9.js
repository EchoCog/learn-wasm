var ye=Object.defineProperty;var D=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var oe=(r,i,n)=>i in r?ye(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,Y=(r,i)=>{for(var n in i||(i={}))ne.call(i,n)&&oe(r,n,i[n]);if(D)for(var n of D(i))ie.call(i,n)&&oe(r,n,i[n]);return r};var se=(r,i)=>{var n={};for(var a in r)ne.call(r,a)&&i.indexOf(a)<0&&(n[a]=r[a]);if(r!=null&&D)for(var a of D(r))i.indexOf(a)<0&&ie.call(r,a)&&(n[a]=r[a]);return n};import{c as be,r as _,b as Fe}from"./vendor.5dcbd1e0.js";import{a as ae,j as k}from"./index.17ef0532.js";var Le={exports:{}};(function(r){var i=function(n){var a=Object.prototype,f=a.hasOwnProperty,l,m=typeof Symbol=="function"?Symbol:{},d=m.iterator||"@@iterator",F=m.asyncIterator||"@@asyncIterator",O=m.toStringTag||"@@toStringTag";function g(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{g({},"")}catch{g=function(e,o,c){return e[o]=c}}function E(t,e,o,c){var s=e&&e.prototype instanceof T?e:T,h=Object.create(s.prototype),w=new H(c||[]);return h._invoke=ve(t,o,w),h}n.wrap=E;function j(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(c){return{type:"throw",arg:c}}}var A="suspendedStart",z="suspendedYield",W="executing",U="completed",L={};function T(){}function u(){}function p(){}var v={};g(v,d,function(){return this});var P=Object.getPrototypeOf,S=P&&P(P(J([])));S&&S!==a&&f.call(S,d)&&(v=S);var C=p.prototype=T.prototype=Object.create(v);u.prototype=p,g(C,"constructor",p),g(p,"constructor",u),u.displayName=g(p,O,"GeneratorFunction");function ee(t){["next","throw","return"].forEach(function(e){g(t,e,function(o){return this._invoke(e,o)})})}n.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===u||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,g(t,O,"GeneratorFunction")),t.prototype=Object.create(C),t},n.awrap=function(t){return{__await:t}};function I(t,e){function o(h,w,y,$){var b=j(t[h],t,w);if(b.type==="throw")$(b.arg);else{var Z=b.arg,N=Z.value;return N&&typeof N=="object"&&f.call(N,"__await")?e.resolve(N.__await).then(function(R){o("next",R,y,$)},function(R){o("throw",R,y,$)}):e.resolve(N).then(function(R){Z.value=R,y(Z)},function(R){return o("throw",R,y,$)})}}var c;function s(h,w){function y(){return new e(function($,b){o(h,w,$,b)})}return c=c?c.then(y,y):y()}this._invoke=s}ee(I.prototype),g(I.prototype,F,function(){return this}),n.AsyncIterator=I,n.async=function(t,e,o,c,s){s===void 0&&(s=Promise);var h=new I(E(t,e,o,c),s);return n.isGeneratorFunction(e)?h:h.next().then(function(w){return w.done?w.value:h.next()})};function ve(t,e,o){var c=A;return function(h,w){if(c===W)throw new Error("Generator is already running");if(c===U){if(h==="throw")throw w;return re()}for(o.method=h,o.arg=w;;){var y=o.delegate;if(y){var $=te(y,o);if($){if($===L)continue;return $}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(c===A)throw c=U,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);c=W;var b=j(t,e,o);if(b.type==="normal"){if(c=o.done?U:z,b.arg===L)continue;return{value:b.arg,done:o.done}}else b.type==="throw"&&(c=U,o.method="throw",o.arg=b.arg)}}}function te(t,e){var o=t.iterator[e.method];if(o===l){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=l,te(t,e),e.method==="throw"))return L;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return L}var c=j(o,t.iterator,e.arg);if(c.type==="throw")return e.method="throw",e.arg=c.arg,e.delegate=null,L;var s=c.arg;if(!s)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,L;if(s.done)e[t.resultName]=s.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=l);else return s;return e.delegate=null,L}ee(C),g(C,O,"Generator"),g(C,d,function(){return this}),g(C,"toString",function(){return"[object Generator]"});function we(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function H(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(we,this),this.reset(!0)}n.keys=function(t){var e=[];for(var o in t)e.push(o);return e.reverse(),function c(){for(;e.length;){var s=e.pop();if(s in t)return c.value=s,c.done=!1,c}return c.done=!0,c}};function J(t){if(t){var e=t[d];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var o=-1,c=function s(){for(;++o<t.length;)if(f.call(t,o))return s.value=t[o],s.done=!1,s;return s.value=l,s.done=!0,s};return c.next=c}}return{next:re}}n.values=J;function re(){return{value:l,done:!0}}return H.prototype={constructor:H,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(V),!t)for(var e in this)e.charAt(0)==="t"&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o($,b){return h.type="throw",h.arg=t,e.next=$,b&&(e.method="next",e.arg=l),!!b}for(var c=this.tryEntries.length-1;c>=0;--c){var s=this.tryEntries[c],h=s.completion;if(s.tryLoc==="root")return o("end");if(s.tryLoc<=this.prev){var w=f.call(s,"catchLoc"),y=f.call(s,"finallyLoc");if(w&&y){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(w){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else if(y){if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o];if(c.tryLoc<=this.prev&&f.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var s=c;break}}s&&(t==="break"||t==="continue")&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var h=s?s.completion:{};return h.type=t,h.arg=e,s?(this.method="next",this.next=s.finallyLoc,L):this.complete(h)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),L},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),V(o),L}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var c=o.completion;if(c.type==="throw"){var s=c.arg;V(o)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:J(t),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=l),L}},n}(r.exports);try{regeneratorRuntime=i}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}})(Le);var Ee={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let X=!1,pe=()=>{};const Se=r=>{X=r},$e=r=>{pe=r},je=(r,i)=>{pe({type:r,message:i}),X&&console.log(`[${r}] ${i}`)};var he={logging:X,setLogging:Se,setCustomLogger:$e,log:je};let x=0,K=0;const ce=r=>{const[i,n,a]=r.split(":");return parseFloat(i)*60*60+parseFloat(n)*60+parseFloat(a)};var ke=(r,i)=>{if(typeof r=="string")if(r.startsWith("  Duration")){const n=r.split(", ")[0].split(": ")[1],a=ce(n);i({duration:a,ratio:K}),(x===0||x>a)&&(x=a)}else if(r.startsWith("frame")||r.startsWith("size")){const n=r.split("time=")[1].split(" ")[0],a=ce(n);K=a/x,i({ratio:K,time:a})}else r.startsWith("video:")&&(i({ratio:1}),x=0)},Pe=(r,i)=>{const n=r._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((a,f)=>{const l=r._malloc(a.length+1);r.writeAsciiToMemory(a,l),r.setValue(n+Uint32Array.BYTES_PER_ELEMENT*f,l,"i32")}),[i.length,n]},q={exports:{}};(function(r,i){(function(n,a){r.exports=a()})(be,function(){function n(){var a=arguments.length;if(a===0)throw new Error("resolveUrl requires at least one argument; got none.");var f=document.createElement("base");if(f.href=arguments[0],a===1)return f.href;var l=document.getElementsByTagName("head")[0];l.insertBefore(f,l.firstChild);for(var m=document.createElement("a"),d,F=1;F<a;F++)m.href=arguments[F],d=m.href,f.href=d;return l.removeChild(f),d}return n})})(q);const Oe="@ffmpeg/ffmpeg",Ce="0.9.8",Re="FFmpeg WebAssembly version",Ge="src/index.js",Ae="src/index.d.ts",Ue={example:"examples"},Te={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},_e={"./src/node/index.js":"./src/browser/index.js"},Ne={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},xe=["ffmpeg","WebAssembly","video"],Be="Jerome Wu <jeromewus@gmail.com>",Me="MIT",We={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Ie={node:">=12.16.1"},De="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Ye={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},qe={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.9.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var me={name:Oe,version:Ce,description:Re,main:Ge,types:Ae,directories:Ue,scripts:Te,browser:_e,repository:Ne,keywords:xe,author:Be,license:Me,bugs:We,engines:Ie,homepage:De,dependencies:Ye,devDependencies:qe};const ze=q.exports,{devDependencies:Ve}=me;var He={corePath:typeof process!="undefined"&&{}.FFMPEG_ENV==="development"?ze("/node_modules/@ffmpeg/core/dist/ffmpeg-core.js"):`https://unpkg.com/@ffmpeg/core@${Ve["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Je=q.exports,{log:M}=he,Q=async(r,i)=>{M("info",`fetch ${r}`);const n=await(await fetch(r)).arrayBuffer();M("info",`${r} file size = ${n.byteLength} bytes`);const a=new Blob([n],{type:i}),f=URL.createObjectURL(a);return M("info",`${r} blob URL = ${f}`),f};var Ze=async({corePath:r})=>{if(typeof r!="string")throw Error("corePath should be a string!");const i=Je(r),n=await Q(i,"application/javascript"),a=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),f=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(l=>{const m=document.createElement("script"),d=()=>{m.removeEventListener("load",d),M("info","ffmpeg-core.js script loaded"),l({createFFmpegCore,corePath:n,wasmPath:a,workerPath:f})};m.src=n,m.type="text/javascript",m.addEventListener("load",d),document.getElementsByTagName("head")[0].appendChild(m)}):(M("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:n,wasmPath:a,workerPath:f}))};const Ke=q.exports,Qe=r=>new Promise((i,n)=>{const a=new FileReader;a.onload=()=>{i(a.result)},a.onerror=({target:{error:{code:f}}})=>{n(Error(`File could not be read! Code=${f}`))},a.readAsArrayBuffer(r)});var Xe=async r=>{let i=r;return typeof r=="undefined"?new Uint8Array:(typeof r=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?i=atob(r.split(",")[1]).split("").map(n=>n.charCodeAt(0)):i=await(await fetch(Ke(r))).arrayBuffer():(r instanceof File||r instanceof Blob)&&(i=await Qe(r)),new Uint8Array(i))};const et=He,tt=Ze,rt=Xe;var de={defaultOptions:et,getCreateFFmpegCore:tt,fetchFile:rt};const{defaultArgs:ot,baseOptions:nt}=Ee,{setLogging:fe,setCustomLogger:le,log:G}=he,it=ke,st=Pe,{defaultOptions:at,getCreateFFmpegCore:ct}=de,{version:ft}=me,ue=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var lt=(r={})=>{const T=Y(Y(Y({},nt),at),r),{log:i,logger:n,progress:a}=T,f=se(T,["log","logger","progress"]);let l=null,m=null,d=null,F=!1,O=a;const g=u=>{u==="FFMPEG_END"&&d!==null&&(d(),d=null,F=!1)},E=({type:u,message:p})=>{G(u,p),it(p,O),g(p)},j=async()=>{if(G("info","load ffmpeg-core"),l===null){G("info","loading ffmpeg-core");const{createFFmpegCore:u,corePath:p,workerPath:v,wasmPath:P}=await ct(f);l=await u({mainScriptUrlOrBlob:p,printErr:S=>E({type:"fferr",message:S}),print:S=>E({type:"ffout",message:S}),locateFile:(S,C)=>{if(typeof window!="undefined"){if(typeof P!="undefined"&&S.endsWith("ffmpeg-core.wasm"))return P;if(typeof v!="undefined"&&S.endsWith("ffmpeg-core.worker.js"))return v}return C+S}}),m=l.cwrap("proxy_main","number",["number","number"]),G("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},A=()=>l!==null,z=(...u)=>{if(G("info",`run ffmpeg command: ${u.join(" ")}`),l===null)throw ue;if(F)throw Error("ffmpeg.wasm can only run one command at a time");return F=!0,new Promise(p=>{const v=[...ot,...u].filter(P=>P.length!==0);d=p,m(...st(l,v))})},W=(u,...p)=>{if(G("info",`run FS.${u} ${p.map(v=>typeof v=="string"?v:`<${v.length} bytes binary file>`).join(" ")}`),l===null)throw ue;{let v=null;try{v=l.FS[u](...p)}catch{throw Error(u==="readdir"?`ffmpeg.FS('readdir', '${p[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:u==="readFile"?`ffmpeg.FS('readFile', '${p[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return v}},U=u=>{O=u},L=u=>{le(u)};return fe(i),le(n),G("info",`use ffmpeg.wasm v${ft}`),{setProgress:U,setLogger:L,setLogging:fe,load:j,isLoaded:A,run:z,FS:W}};const ut=lt,{fetchFile:pt}=de;var ge={createFFmpeg:ut,fetchFile:pt};const B=ge.createFFmpeg({log:!0});function vt(){const[r,i]=_.exports.useState(!1),[n,a]=_.exports.useState("Click Start to transcode"),[f,l]=_.exports.useState(null),[m,d]=_.exports.useState(null),[F,O]=_.exports.useState(0);return _.exports.useEffect(()=>{(async()=>(await B.load(),i(!0),B.setProgress(E=>{O(+(E.ratio*100).toFixed(2))})))()},[]),r?ae("div",{children:[k(ht,{file:f}),k("br",{}),k("input",{type:"file",onChange:E=>{var j;return l((j=E.target.files)==null?void 0:j[0])}}),k("br",{}),f&&k("button",{onClick:async()=>{if(!f)return;const E=f==null?void 0:f.name;a("Start transcoding"),B.FS("writeFile",E,await ge.fetchFile(f)),await B.run("-i",E,"test.gif"),a("End transcoding");const j=B.FS("readFile","test.gif"),A=URL.createObjectURL(new Blob([j.buffer],{type:"image/gif"}));d(A)},children:"convert to gif"}),k("br",{}),n,F!==0&&F!==100&&ae("div",{children:[F,"%"]}),k("br",{}),m&&k("img",{width:500,src:m})]}):k("div",{children:"loading..."})}const ht=Fe.memo(({file:r})=>r&&k("video",{controls:!0,width:400,src:URL.createObjectURL(r)}));export{vt as default};
